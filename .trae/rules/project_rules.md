# 项目规则文档

## 1. 代码组织结构规范

### 1.1 FB文件夹
FB(Function Block)文件夹用于存放功能块相关代码：
- Analog/: 模拟量处理功能块
- DataParsing/: 数据解析功能块，包含各类设备数据处理
- DeviceControl/: 设备控制功能块
- ModbusCommunication/: Modbus通信功能块
- PID/: PID控制算法功能块
- StateMachine/: 状态机功能块
- Valve/: 阀门控制功能块

### 1.2 HRCS文件夹
HRCS文件夹用于存放系统运行时代码：
- 00DataBlock/: 数据块存储区，包含全局变量、报警、映射等DB块
- 01Map/: 变量映射逻辑
- 02Connect/: 通信连接相关代码
- ALM/: 报警处理逻辑
- Instance/: 功能块实例化代码
- Process/: 工艺流程控制代码
- Types/: 系统枚举类型定义

## 2. 命名规范

### 2.1 变量前缀规范
- x: Bool类型
- ui: UInt类型
- i: Int类型
- r: Real类型
- s: String类型
- b: Byte类型
- w: Word类型
- dw: DWord类型

### 2.2 变量方向前缀
- IN_: 输入变量
- OUT_: 输出变量
- STAT_: 状态变量
- CFG_: 配置变量

### 2.3 文件命名规范
- 功能块文件: *_FB.scl
- 用户数据类型: UDT_*.udt
- 数据块: *_DB.db
- 实例化文件: *_Instance.scl

## 3. UDT数据类型定义规范

### 3.1 UDT组织结构
- 每个功能块目录下设置UDT子目录
- UDT文件按功能模块分类存放
- 通用数据类型放在根目录的UDT文件夹

### 3.2 UDT命名规范
```
TYPE "UDT_[模块名]_[功能描述]"
VERSION : 0.1
   STRUCT
      // 变量定义
   END_STRUCT;
END_TYPE
```

### 3.3 注释规范
- 每个变量必须添加中文注释
- 注释使用双斜杠(//)，保持统一格式

## 4. Instance实例化规范

### 4.1 实例化文件组织
- 按功能模块分类创建实例化文件
- Main.scl作为程序入口
- 相似功能的实例集中在同一文件中管理

### 4.2 实例命名规范
- 实例名需反映功能和位置
- 使用下划线分隔不同含义的部分
- 例：Valve_H2_Supply（氢气供应阀）

## 5. 数据块(DB)规范

### 5.1 DB块分类
- ALM_DB: 报警数据
- GlobalVariable_DB: 全局变量
- HMI_DB: 人机界面数据
- Keep_DB: 断电保持数据
- Map_DB: 映射数据
- Temp_DB: 临时数据

### 5.2 DB块访问优化
- 相关性强的数据放在同一DB块
- 合理设置DB块的读写属性
- 优化DB块的访问效率

## 6. 代码生成规则

### 6.1 模板规范
- 保持功能块接口的一致性
- 统一错误处理机制
- 标准化状态机实现

### 6.2 生成约束
- 遵循已定义的命名规范
- 保持代码结构的清晰性
- 确保生成代码的可维护性